# 新版航空可视化系统 - 使用指南

## 🎯 系统概览

新版航空可视化系统使用 **Streamlit + PyDeck** 实现了真正的实时交互，取代了之前的 Folium 静态方案。

### ✨ **新功能特性**

#### 🗺️ **2D/3D 地图切换**
- **2D 模式**: 传统平面地图视图，快速浏览
- **3D 模式**: 立体柱状图显示，天气站高度表示云底高度
- **实时切换**: 无需重新加载，即时切换视图模式

#### 🎨 **多种地图样式**
- **satellite**: 卫星地图（默认）
- **light**: 明亮主题
- **dark**: 深色主题  
- **streets**: 街道地图
- **outdoors**: 户外地形图

#### 📡 **智能站点显示**
- **默认显示所有数据库站点**: 自动从 weather.db 加载所有可用气象站
- **一键开关控制**: 可随时隐藏/显示所有站点
- **性能优化**: 智能缓存，避免重复数据库查询

#### ✈️ **高级路线规划**
- **点击添加站点**: 在地图上直接点击气象站添加到路线
- **混合路径支持**: 起点和终点必须是气象站，中间可以是任意地图点位
- **路径验证**: 自动检查路径有效性
- **距离计算**: 实时计算总飞行距离和预估时间

#### 🌤️ **实时天气信息**
- **悬停显示**: 鼠标悬停在站点上即显示最新天气数据
- **飞行等级**: 根据能见度和云底高度自动分类（VFR/MVFR/IFR/LIFR）
- **颜色编码**: 不同天气条件使用不同颜色标识
- **智能缓存**: 天气数据按小时缓存，提高响应速度

## 🚀 **快速开始**

### 1. **启动应用**

```bash
# 方法1: 使用 conda 环境直接启动
cd /Users/liudongxu/Desktop/studys/aviation_transformer
/Users/liudongxu/opt/miniconda3/envs/aviation/bin/python -m streamlit run aviation_visualization/streamlit_app.py

# 方法2: 使用启动器（自动检查依赖）
python3 launch_aviation_app.py
```

### 2. **访问应用**
打开浏览器访问: **http://localhost:8502**

## 🎛️ **功能使用指南**

### 🗺️ **地图控制**

#### **视图模式切换**
- 在左侧边栏选择 "2D" 或 "3D"
- 3D 模式下站点显示为立体柱状，高度表示云底高度
- 2D 模式下站点显示为平面圆点，性能更佳

#### **地图样式更换**  
- 在下拉菜单中选择不同地图样式
- satellite: 适合航空导航
- dark/light: 适合不同光照环境
- streets: 适合城市区域分析

### 📡 **气象站管理**

#### **显示控制**
- ✅ **"Show All Database Stations"**: 显示数据库中所有气象站
- ❌ **取消勾选**: 隐藏所有气象站，只显示路线

#### **天气信息查看**
- **鼠标悬停**: 在任何气象站上悬停查看详细天气信息
- **颜色编码**:
  - 🟢 **绿色**: VFR (Visual Flight Rules) - 良好天气
  - 🟡 **黄色**: MVFR (Marginal VFR) - 边际天气  
  - 🔴 **红色**: IFR (Instrument Flight Rules) - 恶劣天气
  - ⚫ **深红**: LIFR (Low IFR) - 极恶劣天气

### ✈️ **路线规划**

#### **添加站点到路线**
1. **方法1**: 在左侧边栏下拉菜单中选择气象站，点击 "➕ Add Station to Route"
2. **方法2**: 直接在地图上点击气象站标记（开发中）

#### **路线管理**
- **查看路线**: 当前路线显示在左侧边栏，包含序号和站点名称
- **移除站点**: 点击站点旁边的 "❌" 按钮
- **清空路线**: 点击 "🗑️ Clear Route" 清空整条路线

#### **路线验证**
- ✅ **有效路线**: 起点和终点都是气象站
- ⚠️ **无效路线**: 缺少气象站起点或终点时会显示警告

#### **路线统计**
- **总距离**: 使用 Haversine 公式精确计算大圆距离  
- **飞行时间**: 基于 500 km/h 平均巡航速度估算
- **天气概览**: 显示路线上各站点的飞行等级

### 📊 **实时数据**

#### **天气缓存机制**
- 天气数据按小时缓存，减少数据库查询
- 点击 "🔄 Refresh Weather Cache" 强制更新
- 缓存状态显示在左侧边栏底部

#### **数据库连接**
- 自动连接 `weather_data/weather.db`
- 加载最近48小时的气象站数据
- 显示连接状态和加载的站点数量

## 🎯 **高级功能**

### 🗺️ **地图交互**
- **缩放**: 鼠标滚轮或地图控件
- **平移**: 点击拖拽移动地图
- **3D旋转**: 3D模式下可调整俯仰角和方位角

### 📈 **性能优化**
- **智能缓存**: 天气数据和站点信息多级缓存
- **按需加载**: 只在需要时查询数据库
- **响应式设计**: 适配不同屏幕尺寸

### 🔧 **自定义设置**
- **会话状态**: 所有设置在浏览器会话中保持
- **实时更新**: 任何设置变更立即生效
- **状态管理**: 复杂交互状态自动管理

## 📚 **技术架构对比**

### 🆚 **新版 vs 旧版**

| 特性 | 旧版 (Folium) | 新版 (Streamlit + PyDeck) |
|------|---------------|---------------------------|
| **Python 交互** | ❌ 需要 Flask + AJAX | ✅ 原生 Python 交互 |
| **实时更新** | ❌ 静态 HTML | ✅ 真正实时更新 |
| **2D/3D 切换** | ❌ 不支持 | ✅ 一键切换 |
| **数据库集成** | ⚠️ 复杂配置 | ✅ 直接调用 |
| **开发复杂度** | 🔴 高（前后端分离） | 🟢 低（纯 Python） |
| **维护成本** | 🔴 高 | 🟢 低 |
| **用户体验** | ⚠️ 需要刷新 | ✅ 无缝交互 |

### 🏗️ **系统结构**

```
aviation_visualization/
├── streamlit_app.py           # 🆕 主应用 - Streamlit + PyDeck
├── weather_map.py             # 🔄 保留 - Folium 地图（兼容）
├── map_generator.py           # 🔄 保留 - 高级地图生成器
├── interactive_route_builder.py # 🔄 保留 - HTML 交互式路线构建器
└── __init__.py               # 📦 包导出
```

## 🎉 **使用体验**

### 💡 **推荐工作流程**

1. **🚀 启动应用** - 一键启动，自动打开浏览器
2. **🗺️ 选择视图** - 根据需要选择2D/3D和地图样式  
3. **📡 查看站点** - 开启站点显示，浏览天气情况
4. **✈️ 规划路线** - 选择起点和终点，查看路线统计
5. **🌤️ 分析天气** - 悬停查看详细信息，评估飞行条件

### 🎯 **典型使用场景**

#### **飞行计划制定**
- 选择合适的起降机场
- 查看沿途天气条件
- 计算飞行距离和时间
- 评估飞行等级和安全性

#### **天气监控**  
- 监控特定区域天气变化
- 比较不同机场天气条件
- 追踪恶劣天气影响范围

#### **训练和教育**
- 学习加拿大机场分布
- 理解天气对飞行的影响
- 练习路线规划技能

---

## 🚀 **现在就开始体验！**

应用已经在 **http://localhost:8502** 启动，享受全新的航空可视化体验！

🛩️ **功能强大** • 🎯 **使用简单** • ⚡ **响应迅速** • 🌤️ **数据实时**